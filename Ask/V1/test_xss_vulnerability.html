<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>XSS Vulnerability Test for sites.html</title>
</head>
<body>
    <h1>XSS Vulnerability Test</h1>
    <p>This page tests whether the fix for the XSS vulnerability in `sites.html` is effective.</p>
    <h2>Rendered Table</h2>
    <table>
        <thead>
            <tr>
                <th>Site Name</th>
                <th>Country</th>
            </tr>
        </thead>
        <tbody id="sites-table-body"></tbody>
    </table>
    <hr>
    <h2>Test Result</h2>
    <div id="test-result" style="font-weight: bold;"></div>

    <script>
        // Mock data containing a malicious script, simulating what could be in output.json
        const mockData = [{
            "site": "Malicious Site<script>document.getElementById('test-result').textContent = 'FAIL: XSS vulnerability exploited!';<\/script>",
            "country": "Innocent Country",
        }];

        // This is the SAFE rendering logic, adapted from the fixed sites.html
        function renderTableWithFix(data) {
            const tableBody = document.getElementById('sites-table-body');
            tableBody.innerHTML = ''; // Clear previous content

            data.forEach(site => {
                const row = document.createElement('tr');

                const nameCell = document.createElement('td');
                nameCell.textContent = site.site; // Using textContent prevents the script from executing
                row.appendChild(nameCell);

                const countryCell = document.createElement('td');
                countryCell.textContent = site.country;
                row.appendChild(countryCell);

                tableBody.appendChild(row);
            });
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Run the safe rendering function
            renderTableWithFix(mockData);

            // Check if the malicious script was executed.
            // We give it a moment to run in case of any weird browser timing.
            setTimeout(() => {
                const resultDiv = document.getElementById('test-result');
                if (resultDiv.textContent.startsWith('FAIL')) {
                    // This block runs if the script successfully modified the div
                    resultDiv.style.color = 'red';
                } else {
                    // This block runs if the script did NOT execute
                    resultDiv.textContent = 'PASS: XSS vulnerability was not exploited. The malicious script is visible as plain text in the table.';
                    resultDiv.style.color = 'green';
                }
            }, 100);
        });
    </script>
</body>
</html>
