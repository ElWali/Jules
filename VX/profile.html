<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Site Profile — RQpedia</title>
    <link rel="stylesheet" href="theme.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A==" crossorigin="" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" />
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js" defer></script>
</head>
<body>
    <header>
        <div class="logo">
            <a href="index.html">RQpedia</a>
        </div>
        <nav class="nav-links">
            <a href="sites.html">Browse data</a>
            <a href="about.html">About</a>
            <a href="contribute.html">Contribute</a>
        </nav>
        <div class="header-actions">
            <button class="small-btn">Download all JSON</button>
        </div>
    </header>

    <main class="container">
        <aside class="panel">
            <div class="info-card">
                <div class="site-header">
                    <div class="site-selector-container">
                        <select id="site-selector" class="site-selector"></select>
                        <div class="selector-nav">
                            <button id="prev-site" class="small-btn">&lt; Prev</button>
                            <button id="next-site" class="small-btn">Next &gt;</button>
                        </div>
                    </div>
                    <input type="search" id="search-filter" placeholder="Filter sites..." class="site-search">
                    <h1 id="site-name">Loading…</h1>
                    <p class="site-type">Archaeological site in <span id="site-country-subheader"></span></p>
                    <div class="site-meta">
                        Record created in XRONOS on <span id="created-date"></span>. Last updated on <span id="updated-date"></span>.
                        <a href="#changelog">See changelog for details.</a>
                    </div>
                </div>
            </div>

            <!-- Location -->
            <div class="info-card">
                <h2 class="info-card-header">Location</h2>
                <table>
                    <tr>
                        <th>Coordinates (degrees)</th>
                        <td id="coords-deg" data-label="Coordinates (degrees)"></td>
                    </tr>
                    <tr>
                        <th>Coordinates (DMS)</th>
                        <td id="coords-dms" data-label="Coordinates (DMS)"></td>
                    </tr>
                    <tr>
                        <th>Country</th>
                        <td id="country" data-label="Country"></td>
                    </tr>
                    <tr>
                        <th>Site Type</th>
                        <td id="site-type" data-label="Site Type"></td>
                    </tr>
                </table>
            </div>

            <!-- Map -->
            <div id="map"></div>
            <div class="map-controls">
                <button id="center-map" class="small-btn">Center Map</button>
            </div>
        </aside>

        <section>
            <!-- Radiocarbon Dates -->
            <div class="info-card">
                <h2 class="info-card-header">Radiocarbon Dates</h2>
                <table id="c14-table" class="table">
                    <thead>
                        <tr>
                            <th>Lab ID</th>
                            <th>Context</th>
                            <th>Material</th>
                            <th>Taxon</th>
                            <th>Method</th>
                            <th>Uncalibrated age</th>
                            <th>Calibrated age</th>
                            <th>References</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Populated by script -->
                    </tbody>
                </table>
            </div>

            <!-- Timeline and Histogram -->
            <div id="charts" class="info-card">
                <h2 class="info-card-header">Timeline and Histogram</h2>
                <div style="padding: 16px 20px;">
                    <canvas id="timeline-chart"></canvas>
                    <canvas id="histogram-chart"></canvas>
                </div>
            </div>

            <!-- Typological Dates -->
            <div class="info-card">
                <h2 class="info-card-header">Typological Dates</h2>
                <table id="typo-table" class="table">
                    <thead>
                        <tr>
                            <th>Classification</th>
                            <th>Estimated age</th>
                            <th>References</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Populated by script -->
                    </tbody>
                </table>
            </div>

            <!-- Dated Materials -->
            <div class="info-card">
                <h2 class="info-card-header">Dated Materials</h2>
                <div style="padding: 16px 20px;">
                    <canvas id="materials-chart"></canvas>
                </div>
            </div>

            <!-- Site Types -->
            <div class="info-card">
                <h2 class="info-card-header">Site Types Distribution</h2>
                <div style="padding: 16px 20px;">
                    <canvas id="site-types-chart"></canvas>
                </div>
            </div>

            <!-- Bibliographic References -->
            <div class="info-card">
                <h2 class="info-card-header">Bibliographic References</h2>
                <div id="references-container" style="padding: 16px 20px;" aria-live="polite"></div>
            </div>

            <!-- Changelog / Open Data -->
            <div class="info-card" id="changelog">
                <h2 class="info-card-header">Open data related to the archaeological site</h2>
                <div style="padding: 16px 20px;">
                    <p>
                        Display open data related to the archaeological site fetched automatically from Wikimedia Commons, Wikidata and other open data sources (images, videos, …)
                    </p>
                    <div id="changelog-container" aria-live="polite"></div>
                </div>
            </div>

            <!-- Linked Open Data – moved to bottom -->
            <div class="info-card">
                <div style="display: flex; justify-content: space-between; align-items: flex-start; flex-wrap: wrap; gap: 16px; padding: 16px 20px;">
                    <h2 class="info-card-header">Linked Open Data</h2>
                    <button id="report-link-btn" class="small-btn">
                        <i class="bi bi-link-45deg"></i> Report missing link
                    </button>
                </div>
                <div id="linked-data-content" style="padding: 0 20px 16px;" aria-live="polite">
                    <p style="color: var(--muted);">Loading linked open data from Wikidata and DBpedia…</p>
                </div>
                <div id="media-content" style="padding: 0 20px 16px;" aria-live="polite">
                    <p style="color: var(--muted);">Loading media…</p>
                </div>
            </div>

            <!-- Actions -->
            <div class="info-card">
                <h2 class="info-card-header">Actions</h2>
                <div style="padding: 16px 20px;">
                    <button id="download-csv" class="small-btn">Download CSV</button>
                    <button id="clear-linked-cache" class="small-btn">Clear Cache</button>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <p>
            This work is licensed under a
            <a href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
        </p>
        <p>
            <a href="https://github.com/xronos-ch/xronos.rails/">View source on GitHub</a>
        </p>
    </footer>

    <script src="parser.js"></script>
    <script src="profile.js"></script>
</body>
</html>
