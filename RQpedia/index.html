<!DOCTYPE html>
<html>
<head>
	<title>RQpedia Map</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.1/dist/leaflet.css" />
	<style>
		body { margin: 0; padding: 0; }
		#map { position: absolute; top: 0; bottom: 0; width: 100%; }
		#search-container {
			position: absolute;
			top: 10px;
			right: 10px;
			z-index: 1000;
			background: white;
			padding: 10px;
			border-radius: 5px;
			box-shadow: 0 0 15px rgba(0,0,0,0.2);
		}
		#search-input {
			width: 200px;
			padding: 5px;
			border: 1px solid #ccc;
			border-radius: 3px;
		}
		#search-results {
			list-style: none;
			padding: 0;
			margin: 5px 0 0 0;
			max-height: 200px;
			overflow-y: auto;
		}
		#search-results li {
			padding: 5px;
			cursor: pointer;
		}
		#search-results li:hover {
			background: #f4f4f4;
		}
	</style>
</head>
<body>
	<div id="map"></div>
	<div id="search-container">
		<input type="text" id="search-input" placeholder="Search for a site...">
		<ul id="search-results"></ul>
	</div>
	<script src="https://unpkg.com/leaflet@1.9.1/dist/leaflet.js"></script>
	<script>
		var map = L.map('map').setView([32, -6], 5);

		L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
			attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
		}).addTo(map);

		const searchInput = document.getElementById('search-input');
		const searchResults = document.getElementById('search-results');
		let sites = [];
		let markers = [];

		fetch('data/morocco_sites_filtered.json')
			.then(response => response.json())
			.then(data => {
				sites = data;
				sites.forEach(site => {
					const marker = L.marker([site.latitude, site.longitude])
						.addTo(map)
						.bindPopup(site.site_name);
					markers.push(marker);
				});
			});

		searchInput.addEventListener('input', () => {
			const searchTerm = searchInput.value.toLowerCase();
			searchResults.innerHTML = '';
			if (searchTerm.length === 0) {
				return;
			}

			const filteredSites = sites.filter(site =>
				site.site_name.toLowerCase().includes(searchTerm)
			);

			filteredSites.forEach(site => {
				const li = document.createElement('li');
				li.innerText = site.site_name;
				li.addEventListener('click', () => {
					const correspondingMarker = markers.find(
						marker => marker.getPopup().getContent() === site.site_name
					);
					if (correspondingMarker) {
						map.setView(correspondingMarker.getLatLng(), 13);
						correspondingMarker.openPopup();
					}
					searchResults.innerHTML = '';
					searchInput.value = site.site_name;
				});
				searchResults.appendChild(li);
			});
		});
	</script>
</body>
</html>
